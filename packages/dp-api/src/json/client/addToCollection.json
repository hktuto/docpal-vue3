{"widgetList":[{"key":53349,"type":"static-text","icon":"static-text","formItemFlag":false,"options":{"name":"statictext58888","columnWidth":"200px","hidden":false,"textContent":"collections_caption","textAlign":"left","fontSize":"13px","preWrap":false,"customClass":[],"onCreated":"","onMounted":"// /nuxeo/collection/all","label":"static-text"},"id":"statictext58888"},{"key":9512,"type":"select","icon":"select-field","formItemFlag":true,"options":{"name":"idOrPath","label":"","labelAlign":"","defaultValue":"","placeholder":"","columnWidth":"200px","size":"","labelWidth":null,"labelHidden":false,"disabled":false,"hidden":false,"clearable":true,"filterable":true,"allowCreate":true,"remote":false,"automaticDropdown":false,"multiple":false,"multipleLimit":0,"optionItems":[],"required":false,"requiredHint":"","validation":"","validationHint":"","customClass":[],"labelIconClass":null,"labelIconPosition":"rear","labelTooltip":null,"onCreated":"","onMounted":"const _this = this\ngetCollections()\nasync function getCollections () {\n  const data = await $api.get('/nuxeo/collection/all').then(res => res.data.data)\n  const collectionList = data.reduce((prev,item) => {\n    if (item.id) prev.push({\n      label: item.name,\n      value: item.id\n    })\n    return prev\n  }, [])\n  _this.loadOptions(collectionList)\n}","onRemoteQuery":"","onChange":"","onFocus":"","onBlur":"","onValidate":""},"id":"select71942"},{"key":89112,"type":"button","icon":"button","formItemFlag":false,"options":{"name":"submit","label":"submit","columnWidth":"200px","size":"","displayStyle":"block","disabled":false,"hidden":false,"type":"primary","plain":false,"round":false,"circle":false,"icon":null,"customClass":["right"],"onCreated":"","onMounted":"this.setDisabled(false)","onClick":"const _this = this\nconst idOrPathRef = this.getWidgetRef('idOrPath')\nconst selectedValue = idOrPathRef.getValue()\nconst collections = idOrPathRef.getOptionItems() \nconst index = collections.findIndex(item => item.value === selectedValue)\nhandleSubmit()\nasync function handleSubmit() {\n  _this.setDisabled(true)\n  let idOrPath = selectedValue\n  if (index === -1) {\n    const data = await createCollectionApi(selectedValue)\n    idOrPath = data.id\n    getCollections()\n  }\n  const vform = _this.getFormRef()\n  vform.$emit('emit', 'handleSubmit', {\n    idOrPath\n  })\n}\nasync function createCollectionApi(name) {\n  return await $api.post('/nuxeo/collection/create', { name }).then(res => res.data.data)\n}\nasync function getCollections () {\n  const data = await $api.get('/nuxeo/collection/all').then(res => res.data.data)\n  const collectionList = data.reduce((prev,item) => {\n    if (item.id) prev.push({\n      label: item.name,\n      value: item.id\n    })\n    return prev\n  }, [])\n  idOrPathRef.loadOptions(collectionList)\n}"},"id":"button15356"}],"formConfig":{"modelName":"formData","refName":"vForm","rulesName":"rules","labelWidth":80,"labelPosition":"top","size":"","labelAlign":"label-left-align","cssCode":".right{\n  float: right;\n}","customClass":[],"functions":"","layoutType":"PC","jsonVersion":3,"onFormCreated":"","onFormMounted":"","onFormDataChange":"","onFormValidate":"","saveRemoteOptions":"never","labelFormUniqueName":true,"dataSources":[]}}